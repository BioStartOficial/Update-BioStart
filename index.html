<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BioStart Admin - BioCarteira</title>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts - Poppins (ou Roboto, como solicitado) -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- React CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel Standalone for JSX transformation in browser -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        body {
            font-family: 'Poppins', sans-serif; /* Usando Poppins */
            margin: 0;
            background-color: #F5F5F5; /* Fundo cinza claro */
        }
        .animate-spin {
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- CONFIGURAÇÃO DO BACKEND (mockup, não funcional) ---
        const BACKEND_URL = "https://mockup-backend.com"; 

        // --- Ícones (SVG como componentes) ---
        const HomeIcon = (props) => (<svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>);
        const BookTextIcon = (props) => (<svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M4 19.5V15a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v4.5a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2Z"/><path d="M4 12V6a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v6"/><path d="M9 10h6"/></svg>);
        const UsersIcon = (props) => (<svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>);
        const MessageSquareIcon = (props) => (<svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>);
        const BarChartIcon = (props) => (<svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" x2="12" y1="20" y2="10"/><line x1="18" x2="18" y1="20" y2="4"/><line x1="6" x2="6" y1="20" y2="16"/></svg>);
        const PlusCircleIcon = (props) => (<svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><path d="M8 12h8"/><path d="M12 8v8"/></svg>);
        const EditIcon = (props) => (<svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z"/></svg>);
        const Trash2Icon = (props) => (<svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>);
        const CheckCircleIcon = (props) => (<svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-8.5"/><polyline points="22 4 12 14.01 9 11.01"/></svg>);
        const XCircleIcon = (props) => (<svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><path d="m15 9-6 6"/><path d="m9 9 6 6"/></svg>);
        const SparklesIcon = (props) => (<svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.272 1.272L3 12l5.813 1.912a2 2 0 0 1 1.272 1.272L12 21l1.912-5.813a2 2 0 0 1 1.272-1.272L21 12l-5.813-1.912a2 2 0 0 1-1.272-1.272Z"/><path d="M5 3v4"/><path d="M19 17v4"/><path d="M2.75 7.25h4.5"/><path d="M16.25 16.75h4.5"/></svg>);
        const LogOutIcon = (props) => (<svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" x2="9" y1="12" y2="12"/></svg>);
        const WalletIcon = (props) => (<svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h12a2 2 0 0 1 0 4H5a2 2 0 0 0 0 4h12a2 2 0 0 0 2-2v-3"/><path d="M2 7v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z"/></svg>);


        // --- Componentes Reutilizáveis de UI ---
        const Toast = ({ message, type, onClose }) => {
            if (!message) return null;
            const bgColor = type === 'success' ? 'bg-green-500' : (type === 'error' ? 'bg-red-500' : 'bg-blue-500');
            return (
                <div className={`fixed bottom-4 right-4 ${bgColor} text-white px-6 py-3 rounded-lg shadow-lg z-50`}>
                    <div className="flex items-center justify-between">
                        <span>{message}</span>
                        <button onClick={onClose} className="ml-4 text-white hover:text-gray-200">&times;</button>
                    </div>
                </div>
            );
        };

        const Modal = ({ isOpen, onClose, title, children }) => {
            if (!isOpen) return null;
            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-40">
                    <div className="bg-white p-6 rounded-lg shadow-xl max-w-lg w-full max-h-[90vh] overflow-y-auto">
                        <div className="flex justify-between items-center border-b pb-3 mb-4">
                            <h2 className="text-xl font-bold text-gray-800">{title}</h2>
                            <button onClick={onClose} className="text-gray-500 hover:text-gray-700 text-2xl leading-none">&times;</button>
                        </div>
                        <div>{children}</div>
                    </div>
                </div>
            );
        };

        const ConfirmModal = ({ isOpen, onClose, onConfirm, message }) => {
            if (!isOpen) return null;
            return (
                <Modal isOpen={isOpen} onClose={onClose} title="Confirmação">
                    <p className="text-gray-700 mb-6">{message}</p>
                    <div className="flex justify-end space-x-3">
                        <button
                            onClick={onClose}
                            className="px-4 py-2 bg-gray-300 text-gray-800 rounded-lg hover:bg-gray-400 transition-colors"
                        >
                            Cancelar
                        </button>
                        <button
                            onClick={() => { onConfirm(); onClose(); }}
                            className="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors"
                        >
                            Confirmar
                        </button>
                    </div>
                </Modal>
            );
        };

        const NavItem = ({ icon, text, isActive, onClick }) => (
            <li className="mb-2">
                <button
                    onClick={onClick}
                    className={`flex items-center w-full p-3 rounded-lg transition-all duration-200 ${isActive ? 'bg-[#4CAF50] font-semibold text-white' : 'hover:bg-gray-700 text-gray-200'}`}
                >
                    {icon}
                    <span className="ml-3">{text}</span>
                </button>
            </li>
        );

        // --- Telas da Aplicação (Mockups) ---
        const SplashPage = () => (
            <div className="flex items-center justify-center min-h-screen bg-[#4CAF50]">
                <div className="flex flex-col items-center">
                    <svg className="animate-spin text-white w-20 h-20 mb-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                        <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    <h1 className="text-4xl font-bold text-white">Carregando...</h1>
                </div>
            </div>
        );

        const AdminLoginPage = ({ onAuthSuccess, showToast }) => {
            const [isRegistering, setIsRegistering] = useState(false);
            const [name, setName] = useState('');
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [confirmPassword, setConfirmPassword] = useState('');
            const [isLoading, setIsLoading] = useState(false);

            const handleAuth = async (e) => {
                e.preventDefault();
                setIsLoading(true);
                // Mockup: Apenas simula sucesso para qualquer input
                setTimeout(() => {
                    if (isRegistering) {
                        if (password !== confirmPassword) {
                            showToast('As senhas não coincidem.', 'error');
                            setIsLoading(false);
                            return;
                        }
                        showToast(`Administrador(a) ${name} registado(a) com sucesso!`, 'success');
                        setIsRegistering(false);
                    } else {
                        showToast(`Bem-vindo(a), Admin!`, 'success');
                        onAuthSuccess('Admin', 'admin@example.com', 'mockAdminId');
                    }
                    setIsLoading(false);
                }, 1500);
            };

            return (
                <div className="flex items-center justify-center min-h-screen bg-gray-900 p-4">
                    <div className="bg-white p-8 rounded-2xl shadow-2xl max-w-sm w-full">
                        <h2 className="text-3xl font-bold text-gray-800 mb-2 text-center">
                            {isRegistering ? 'Registar Admin' : 'Admin Login'}
                        </h2>
                        <form onSubmit={handleAuth}>
                            {isRegistering && (
                                <div className="mb-4">
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Nome</label>
                                    <input type="text" value={name} onChange={(e) => setName(e.target.value)} className="w-full p-3 border border-gray-300 rounded-lg" required />
                                </div>
                            )}
                            <div className="mb-4">
                                <label className="block text-sm font-medium text-gray-700 mb-1">Email</label>
                                <input type="email" value={email} onChange={(e) => setEmail(e.target.value)} className="w-full p-3 border border-gray-300 rounded-lg" required />
                            </div>
                            <div className="mb-4">
                                <label className="block text-sm font-medium text-gray-700 mb-1">Senha</label>
                                <input type="password" value={password} onChange={(e) => setPassword(e.target.value)} className="w-full p-3 border border-gray-300 rounded-lg" required />
                            </div>
                            {isRegistering && (
                                <div className="mb-6">
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Confirmar Senha</label>
                                    <input type="password" value={confirmPassword} onChange={(e) => setConfirmPassword(e.target.value)} className="w-full p-3 border border-gray-300 rounded-lg" required />
                                </div>
                            )}
                            <button type="submit" className="w-full bg-[#4CAF50] hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg disabled:opacity-50" disabled={isLoading}>
                                {isLoading ? 'Processando...' : (isRegistering ? 'Registar' : 'Entrar')}
                            </button>
                            <button type="button" onClick={() => setIsRegistering(!isRegistering)} className="w-full mt-4 text-[#4CAF50] hover:underline">
                                {isRegistering ? 'Já tem conta? Faça login' : 'Não tem conta? Registar'}
                            </button>
                        </form>
                    </div>
                </div>
            );
        };

        const Dashboard = () => {
            const MetricCard = ({ title, value, description }) => (
                <div className="bg-white p-6 rounded-lg shadow-md border-l-4 border-blue-500 hover:shadow-lg transition-shadow duration-300">
                    <h3 className="text-lg font-semibold text-gray-700">{title}</h3>
                    <p className="text-4xl font-bold text-gray-900 mt-2">{value}</p>
                    <p className="text-sm text-gray-500 mt-1">{description}</p>
                </div>
            );
            return (
                <div>
                    <h2 className="text-3xl font-bold text-gray-800 mb-6">Dashboard</h2>
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                        <MetricCard title="Acessos Totais" value="12.450" description="Últimos 30 dias" />
                        <MetricCard title="Simulações Realizadas" value="1.870" description="Média diária: 62" />
                        <MetricCard title="Acertos no Quiz" value="85%" description="Taxa de acerto média" />
                    </div>
                    <div className="bg-white p-6 rounded-lg shadow-md">
                        <h3 className="text-xl font-semibold text-gray-700 mb-4">Gráfico de Uso do App (Simulado)</h3>
                        <div className="bg-gray-200 h-64 rounded-md flex items-center justify-center">
                            <p className="text-gray-500">[Aqui seria renderizado um gráfico interativo]</p>
                        </div>
                    </div>
                </div>
            );
        };
        
        const ContentManagement = ({ showToast }) => {
            const [activeTab, setActiveTab] = useState('educationalTexts');
            const [content, setContent] = useState([]);
            const [isLoading, setIsLoading] = useState(true);
            const [isModalOpen, setIsModalOpen] = useState(false);
            const [isEditing, setIsEditing] = useState(false);
            const [currentItem, setCurrentItem] = useState(null);

            const [isAiModalOpen, setAiModalOpen] = useState(false);
            const [aiTopic, setAiTopic] = useState('');
            const [generatedContent, setGeneratedContent] = useState('');
            const [isGenerating, setIsGenerating] = useState(false);

            const [isConfirmModalOpen, setIsConfirmModalOpen] = useState(false);
            const [confirmAction, setConfirmAction] = useState(null); 

            const contentConfig = {
                educationalTexts: { name: 'Textos Educativos', endpoint: 'educational-texts'},
                quizzes: { name: 'Quizzes', endpoint: 'quizzes'},
                checklists: { name: 'Checklists', endpoint: 'checklists'},
                simulations: { name: 'Simulações', endpoint: 'simulations'}
            };

            const fetchContent = async () => {
                setIsLoading(true);
                // Mockup: Apenas simula carregamento
                setTimeout(() => {
                    const mockData = {
                        'educationalTexts': [
                            { id: '1', title: 'O que é Biogás?', content: 'Biogás é um combustível...', imageUrl: 'https://placehold.co/100x100/green/white?text=Img1' },
                            { id: '2', title: 'Vantagens do Biodigestor', content: 'Reduz resíduos e gera energia...', imageUrl: 'https://placehold.co/100x100/green/white?text=Img2' },
                        ],
                        'quizzes': [
                            { id: 'q1', title: 'Quiz Básico', questions: '[{"question":"Q1","options":["A","B"],"correct":0}]' },
                        ],
                        'checklists': [
                            { id: 'c1', title: 'Checklist Inicial', items: '[{"text":"Item 1"},{"text":"Item 2"}]' },
                        ],
                        'simulations': [
                            { id: 's1', title: 'Simulação Padrão', description: 'Dados de simulação.' },
                        ]
                    };
                    setContent(mockData[activeTab] || []);
                    setIsLoading(false);
                }, 500);
            };

            useEffect(() => {
                fetchContent();
            }, [activeTab]);

            const handleDelete = (id) => {
                setConfirmAction(() => () => {
                    showToast('Item excluído com sucesso! (Mockup)', 'success');
                    setContent(prev => prev.filter(item => item.id !== id));
                });
                setIsConfirmModalOpen(true);
            };
            
            const openModal = (item = null) => {
                setIsEditing(!!item);
                let initialItem = { title: '', content: '', annexUrl: '' };
                if (item) {
                    const contentValue = item.content || 
                                        (item.questions ? JSON.stringify(item.questions, null, 2) : '') ||
                                        (item.items ? JSON.stringify(item.items, null, 2) : '') ||
                                        item.description || '';
                    initialItem = { ...item, content: contentValue };
                }
                setCurrentItem(initialItem);
                setIsModalOpen(true);
            };
            
            const handleSave = async () => {
                // Mockup: Apenas simula salvamento
                showToast(`Item ${isEditing ? 'atualizado' : 'salvo'} com sucesso! (Mockup)`, 'success');
                setIsModalOpen(false);
                fetchContent(); // Recarrega para mostrar a mudança no mockup
            };

            const openAiModal = () => {
                setAiTopic('');
                setGeneratedContent('');
                setAiModalOpen(true);
            };

            const handleGenerateContent = async () => {
                if (!aiTopic.trim()) {
                    showToast('Por favor, insira um tópico.', 'info');
                    return;
                }
                setIsGenerating(true);
                setGeneratedContent('');
                setTimeout(() => {
                    const generated = activeTab === 'quizzes' 
                        ? JSON.stringify([{question: `Mock Q sobre ${aiTopic}`, options: ["A","B","C","D"], correct: 0}], null, 2)
                        : `Conteúdo simulado sobre ${aiTopic} gerado por IA.`;
                    setGeneratedContent(generated);
                    showToast('Conteúdo gerado com sucesso! (Mockup)', 'success');
                    setIsGenerating(false);
                }, 1500);
            };

            const TabButton = ({ text, isActive, onClick }) => (
                <button onClick={onClick} className={`py-2 px-4 font-medium text-sm border-b-2 ${isActive ? 'border-[#4CAF50] text-[#4CAF50]' : 'border-transparent text-gray-500 hover:border-gray-300'}`}>
                    {text}
                </button>
            );

            return (
                <div className="bg-white p-6 rounded-lg shadow-xl">
                    <h2 className="text-3xl font-bold text-gray-800 mb-6">Gestão de Conteúdo</h2>
                    <div className="border-b border-gray-200 mb-4">
                        <nav className="flex flex-wrap -mb-px">
                            {Object.keys(contentConfig).map(key => (
                                <TabButton key={key} text={contentConfig[key].name} isActive={activeTab === key} onClick={() => setActiveTab(key)} />
                            ))}
                        </nav>
                    </div>
                    
                    <div className="flex flex-wrap gap-4 justify-end mb-4">
                        <button onClick={() => openModal()} className="bg-[#4CAF50] hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg flex items-center">
                            <PlusCircleIcon className="w-5 h-5 mr-2" /> Adicionar Novo
                        </button>
                        {(activeTab === 'educationalTexts' || activeTab === 'quizzes') && (
                            <button onClick={openAiModal} className="bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded-lg flex items-center">
                                <SparklesIcon className="w-5 h-5 mr-2" /> Gerar com IA
                            </button>
                        )}
                    </div>

                    {isLoading ? <div className="text-center p-8">Carregando...</div> : (
                        <div className="space-y-4">
                            {content.length > 0 ? content.map(item => (
                                <div key={item.id} className="bg-gray-50 p-4 rounded-lg flex justify-between items-center border">
                                    <div className="flex-1 min-w-0">
                                        <p className="font-semibold truncate">{item.title}</p>
                                        <p className="text-sm text-gray-600 truncate">{item.content || JSON.stringify(item.questions) || JSON.stringify(item.items) || item.description}</p>
                                    </div>
                                    <div className="flex-shrink-0 flex items-center space-x-2 ml-4">
                                        <button onClick={() => openModal(item)} className="p-2 rounded-full text-white bg-blue-500 hover:bg-blue-600"><EditIcon className="w-5 h-5" /></button>
                                        <button onClick={() => handleDelete(item.id)} className="p-2 rounded-full text-white bg-red-500 hover:bg-red-600"><Trash2Icon className="w-5 h-5" /></button>
                                    </div>
                                </div>
                            )) : <p className="text-center text-gray-500 p-8">Nenhum conteúdo encontrado.</p>}
                        </div>
                    )}

                    <Modal isOpen={isModalOpen} onClose={() => setIsModalOpen(false)} title={isEditing ? 'Editar Item' : 'Adicionar Item'}>
                        <div className="space-y-4">
                            <input type="text" placeholder="Título" value={currentItem?.title || ''} onChange={e => setCurrentItem({...currentItem, title: e.target.value})} className="w-full p-2 border rounded"/>
                            <textarea placeholder="Conteúdo (ou JSON para Quizzes/Checklists)" value={currentItem?.content || ''} onChange={e => setCurrentItem({...currentItem, content: e.target.value})} className="w-full p-2 border rounded h-32"></textarea>
                            {activeTab === 'educationalTexts' && <input type="text" placeholder="URL da Imagem (opcional)" value={currentItem?.annexUrl || ''} onChange={e => setCurrentItem({...currentItem, annexUrl: e.target.value})} className="w-full p-2 border rounded"/>}
                            <div className="flex justify-end">
                                <button onClick={handleSave} className="bg-[#4CAF50] text-white py-2 px-4 rounded-lg">Salvar</button>
                            </div>
                        </div>
                    </Modal>
                    
                    <Modal isOpen={isAiModalOpen} onClose={() => setAiModalOpen(false)} title="Gerar Conteúdo com IA">
                        <div className="space-y-4">
                            <input type="text" placeholder="Digite o tópico..." value={aiTopic} onChange={e => setAiTopic(e.target.value)} className="w-full p-2 border rounded"/>
                            <button onClick={handleGenerateContent} className="w-full bg-purple-600 text-white py-2 px-4 rounded-lg flex justify-center items-center" disabled={isGenerating}>
                                {isGenerating ? <div className="animate-spin rounded-full h-5 w-5 border-b-2 border-white"></div> : 'Gerar'}
                            </button>
                            {generatedContent && (
                                <textarea value={generatedContent} readOnly className="w-full p-2 border rounded h-40 bg-gray-100"></textarea>
                            )}
                        </div>
                    </Modal>

                    <ConfirmModal
                        isOpen={isConfirmModalOpen}
                        onClose={() => setIsConfirmModalOpen(false)}
                        onConfirm={confirmAction}
                        message="Tem certeza que deseja excluir este item?"
                    />
                </div>
            );
        };

        const UserManagement = ({ showToast }) => {
            const [users, setUsers] = useState([]);
            const [isLoading, setIsLoading] = useState(true);

            useEffect(() => {
                const mockUsers = [
                    { id: 1, name: 'João Silva', email: 'joao.silva@example.com', status: 'Ativo' },
                    { id: 2, name: 'Maria Souza', email: 'maria.souza@example.com', status: 'Ativo' },
                    { id: 3, name: 'Pedro Santos', email: 'pedro.santos@example.com', status: 'Inativo' },
                ];
                setUsers(mockUsers);
                setIsLoading(false);
            }, []);

            const toggleUserStatus = (id) => {
                setUsers(users.map(user => user.id === id ? { ...user, status: user.status === 'Ativo' ? 'Inativo' : 'Ativo' } : user));
                showToast('Status do usuário atualizado. (Mockup)', 'success');
            };

            const deleteUser = (id) => {
                if (window.confirm('Tem certeza que deseja excluir este usuário? (Mockup)')) {
                    setUsers(users.filter(user => user.id !== id));
                    showToast('Usuário excluído. (Mockup)', 'success');
                }
            };

            if (isLoading) return <div className="text-center p-8">Carregando...</div>;

            return (
                <div className="bg-white p-6 rounded-lg shadow-xl">
                    <h2 className="text-3xl font-bold text-gray-800 mb-6">Gestão de Usuários</h2>
                    <div className="overflow-x-auto">
                        <table className="min-w-full bg-white">
                            <thead className="bg-gray-100">
                                <tr>
                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nome</th>
                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Email</th>
                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ações</th>
                                </tr>
                            </thead>
                            <tbody className="divide-y divide-gray-200">
                                {users.map(user => (
                                    <tr key={user.id}>
                                        <td className="px-6 py-4 whitespace-nowrap">{user.name}</td>
                                        <td className="px-6 py-4 whitespace-nowrap">{user.email}</td>
                                        <td className="px-6 py-4 whitespace-nowrap">
                                            <span className={`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${user.status === 'Ativo' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}`}>
                                                {user.status}
                                            </span>
                                        </td>
                                        <td className="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2">
                                            <button onClick={() => toggleUserStatus(user.id)} className={`p-2 rounded-full text-white ${user.status === 'Ativo' ? 'bg-yellow-500' : 'bg-green-500'}`} title={user.status === 'Ativo' ? 'Inativar' : 'Ativar'}>
                                                {user.status === 'Ativo' ? <XCircleIcon className="w-5 h-5"/> : <CheckCircleIcon className="w-5 h-5"/>}
                                            </button>
                                            <button onClick={() => deleteUser(user.id)} className="p-2 rounded-full text-white bg-red-500" title="Excluir">
                                                <Trash2Icon className="w-5 h-5"/>
                                            </button>
                                        </td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                </div>
            );
        };

        const UserDoubts = ({ showToast }) => {
            const [doubts, setDoubts] = useState([]);
            const [isLoading, setIsLoading] = useState(true);

            useEffect(() => {
                const mockDoubts = [
                    { id: 1, user: 'Usuário A', subject: 'Dúvida sobre dimensionamento', message: 'Qual o tamanho ideal do biodigestor para minha fazenda?', status: 'Pendente' },
                    { id: 2, user: 'Usuário B', subject: 'Sugestão de conteúdo', message: 'Gostaria de ver mais sobre o uso do biogás em veículos.', status: 'Pendente' },
                    { id: 3, user: 'Usuário C', subject: 'Problema com quiz', message: 'A pergunta 3 do quiz básico está com a resposta errada.', status: 'Resolvido' },
                ];
                setDoubts(mockDoubts);
                setIsLoading(false);
            }, []);

            const markAsResolved = (id) => {
                setDoubts(doubts.map(doubt => doubt.id === id ? { ...doubt, status: 'Resolvido' } : doubt));
                showToast('Dúvida marcada como resolvida. (Mockup)', 'success');
            };

            if (isLoading) return <div className="text-center p-8">Carregando...</div>;

            return (
                <div className="bg-white p-6 rounded-lg shadow-xl">
                    <h2 className="text-3xl font-bold text-gray-800 mb-6">Dúvidas e Sugestões dos Usuários</h2>
                    <div className="space-y-4">
                        {doubts.map(doubt => (
                            <div key={doubt.id} className="bg-gray-50 p-4 rounded-lg border">
                                <div className="flex justify-between items-start">
                                    <div>
                                        <h3 className="font-bold text-lg">{doubt.subject}</h3>
                                        <p className="text-sm text-gray-600">De: {doubt.user}</p>
                                        <p className="mt-2 text-gray-800">{doubt.message}</p>
                                    </div>
                                    <span className={`flex-shrink-0 ml-4 px-3 py-1 text-xs font-semibold rounded-full ${doubt.status === 'Pendente' ? 'bg-orange-100 text-orange-800' : 'bg-green-100 text-green-800'}`}>
                                        {doubt.status}
                                    </span>
                                </div>
                                {doubt.status === 'Pendente' && (
                                    <div className="flex justify-end mt-4">
                                        <button onClick={() => markAsResolved(doubt.id)} className="bg-[#4CAF50] hover:bg-green-600 text-white font-semibold py-1 px-3 rounded-lg">
                                            Marcar como Resolvido
                                        </button>
                                    </div>
                                )}
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        const Reports = ({ showToast }) => {
            const [selectedRegion, setSelectedRegion] = useState('');
            const [selectedUsageType, setSelectedUsageType] = useState('');
            const [reportGenerated, setReportGenerated] = useState(false);

            const generateReport = () => {
                if (!selectedRegion && !selectedUsageType) {
                    showToast('Por favor, selecione ao menos um filtro.', 'info');
                    return;
                }
                setReportGenerated(true);
                showToast('Relatório simulado gerado com sucesso! (Mockup)', 'success');
            };

            return (
                <div className="bg-white p-6 rounded-lg shadow-xl">
                    <h2 className="text-3xl font-bold text-gray-800 mb-6">Relatórios</h2>
                    <div className="bg-gray-50 p-5 rounded-lg border">
                        <h3 className="text-xl font-semibold text-gray-700 mb-4">Gerar Novo Relatório</h3>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-4">
                            <div>
                                <label htmlFor="region" className="block text-sm font-medium text-gray-700 mb-1">Filtrar por Região:</label>
                                <select id="region" value={selectedRegion} onChange={(e) => setSelectedRegion(e.target.value)} className="mt-1 block w-full p-2 border-gray-300 rounded-md shadow-sm">
                                    <option value="">Todas as Regiões</option>
                                    <option value="rural">Rural</option>
                                    <option value="periferica">Periférica</option>
                                    <option value="urbana">Urbana</option>
                                </select>
                            </div>
                            <div>
                                <label htmlFor="usageType" className="block text-sm font-medium text-gray-700 mb-1">Filtrar por Tipo de Uso:</label>
                                <select id="usageType" value={selectedUsageType} onChange={(e) => setSelectedUsageType(e.target.value)} className="mt-1 block w-full p-2 border-gray-300 rounded-md shadow-sm">
                                    <option value="">Todos os Tipos</option>
                                    <option value="simulador">Uso do Simulador</option>
                                    <option value="quiz">Participação em Quiz</option>
                                    <option value="conteudo">Consumo de Conteúdo</option>
                                </select>
                            </div>
                        </div>
                        <button onClick={generateReport} className="w-full bg-[#4CAF50] hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg mt-4">
                            Gerar Relatório
                        </button>
                    </div>

                    {reportGenerated && (
                        <div className="mt-8 bg-blue-50 p-6 rounded-lg border border-blue-200">
                            <h3 className="text-xl font-semibold text-blue-800 mb-3">Resultado do Relatório Simulado</h3>
                            <p className="mb-2"><strong>Filtros Aplicados:</strong></p>
                            <ul className="list-disc list-inside mb-4 text-blue-700">
                                <li>Região: {selectedRegion || 'Todas'}</li>
                                <li>Tipo de Uso: {selectedUsageType || 'Todos'}</li>
                            </ul>
                            <p><strong>Dados Simulados:</strong></p>
                            <ul className="list-disc list-inside text-blue-700">
                                <li>Usuários ativos na região: <strong>{Math.floor(Math.random() * 500) + 50}</strong></li>
                                <li>Média de simulações: <strong>{Math.floor(Math.random() * 100) + 10}</strong></li>
                                <li>Conteúdos mais acessados: <strong>"Vantagens do Biogás"</strong></li>
                            </ul>
                        </div>
                    )}
                </div>
            );
        };

        // --- NOVA TELA: BioWalletValidations ---
        const BioWalletValidations = ({ showToast }) => {
            const [validations, setValidations] = useState([
                { id: 1, userName: 'João Silva', biodigesterLocation: 'Fazenda Esperança, Rural', suggestedDate: '2025-08-10', status: 'Pendente', observations: '' },
                { id: 2, userName: 'Maria Souza', biodigesterLocation: 'Comunidade Feliz, Urbana', suggestedDate: '2025-08-15', status: 'Confirmado', observations: 'Usuário contatado, visita agendada.' },
                { id: 3, userName: 'Pedro Santos', biodigesterLocation: 'Sítio Verde, Periférica', suggestedDate: '2025-08-01', status: 'Realizado', observations: 'Biodigestor validado, selo gerado.' },
                { id: 4, userName: 'Ana Costa', biodigesterLocation: 'Chácara do Sol, Rural', suggestedDate: '2025-08-20', status: 'Pendente', observations: '' },
            ]);
            const [isSealModalOpen, setIsSealModalOpen] = useState(false);
            const [selectedValidation, setSelectedValidation] = useState(null);
            const [currentObservations, setCurrentObservations] = useState('');

            const updateValidationStatus = (id, newStatus) => {
                setValidations(prev => prev.map(val => 
                    val.id === id ? { ...val, status: newStatus } : val
                ));
                showToast(`Status atualizado para ${newStatus}! (Mockup)`, 'success');
            };

            const openSealModal = (validationItem) => {
                setSelectedValidation(validationItem);
                setCurrentObservations(validationItem.observations);
                setIsSealModalOpen(true);
            };

            const handleSealValidation = () => {
                if (!selectedValidation) return;
                setValidations(prev => prev.map(val => 
                    val.id === selectedValidation.id ? { ...val, status: 'Realizado', observations: currentObservations } : val
                ));
                showToast('Selo gerado e visita realizada! (Mockup)', 'success');
                setIsSealModalOpen(false);
            };

            const getStatusBadgeClass = (status) => {
                switch (status) {
                    case 'Pendente': return 'bg-yellow-100 text-yellow-800';
                    case 'Confirmado': return 'bg-blue-100 text-blue-800';
                    case 'Realizado': return 'bg-green-100 text-green-800';
                    default: return 'bg-gray-100 text-gray-800';
                }
            };

            return (
                <div className="bg-white p-6 rounded-lg shadow-xl">
                    <h2 className="text-3xl font-bold text-gray-800 mb-6">Validações da BioCarteira</h2>
                    <div className="overflow-x-auto">
                        <table className="min-w-full bg-white">
                            <thead className="bg-gray-100">
                                <tr>
                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Usuário</th>
                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Local do Biodigestor</th>
                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Data Sugerida</th>
                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ações</th>
                                </tr>
                            </thead>
                            <tbody className="divide-y divide-gray-200">
                                {validations.map(val => (
                                    <tr key={val.id}>
                                        <td className="px-6 py-4 whitespace-nowrap">{val.userName}</td>
                                        <td className="px-6 py-4 whitespace-nowrap">{val.biodigesterLocation}</td>
                                        <td className="px-6 py-4 whitespace-nowrap">{val.suggestedDate}</td>
                                        <td className="px-6 py-4 whitespace-nowrap">
                                            <span className={`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${getStatusBadgeClass(val.status)}`}>
                                                {val.status}
                                            </span>
                                        </td>
                                        <td className="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2">
                                            {val.status === 'Pendente' && (
                                                <button onClick={() => updateValidationStatus(val.id, 'Confirmado')} className="px-3 py-1 rounded-md bg-blue-500 text-white hover:bg-blue-600">Confirmar visita</button>
                                            )}
                                            {val.status === 'Confirmado' && (
                                                <button onClick={() => updateValidationStatus(val.id, 'Realizado')} className="px-3 py-1 rounded-md bg-orange-500 text-white hover:bg-orange-600">Marcar como realizada</button>
                                            )}
                                            {val.status !== 'Realizado' && (
                                                <button onClick={() => openSealModal(val)} className="px-3 py-1 rounded-md bg-[#4CAF50] text-white hover:bg-green-600">Validar e gerar selo</button>
                                            )}
                                        </td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>

                    <Modal isOpen={isSealModalOpen} onClose={() => setIsSealModalOpen(false)} title="Validar e Gerar Selo">
                        <div className="space-y-4">
                            <p className="text-gray-700">Validar visita para: <strong>{selectedValidation?.userName}</strong></p>
                            <textarea 
                                placeholder="Observações da visita (opcional)"
                                value={currentObservations}
                                onChange={(e) => setCurrentObservations(e.target.value)}
                                className="w-full p-2 border rounded-lg h-24"
                            ></textarea>
                            <div className="bg-gray-100 p-4 rounded-lg border border-gray-200 text-center">
                                <h3 className="font-bold text-lg text-gray-800 mb-2">Selo Digital</h3>
                                <div className="bg-white border-2 border-[#4CAF50] p-6 rounded-lg shadow-md flex flex-col items-center justify-center">
                                    <WalletIcon className="w-16 h-16 text-[#4CAF50] mb-4" />
                                    <p className="text-gray-700 text-center font-medium">
                                        Certificamos que este usuário adota práticas sustentáveis de reaproveitamento de resíduos para geração de biogás.
                                    </p>
                                </div>
                            </div>
                            <div className="flex justify-end">
                                <button onClick={handleSealValidation} className="bg-[#4CAF50] text-white py-2 px-4 rounded-lg">Gerar Selo</button>
                            </div>
                        </div>
                    </Modal>
                </div>
            );
        };


        // Componente Principal da Aplicação
        const App = () => {
            const [loggedInUser, setLoggedInUser] = useState(null);
            const [activeScreen, setActiveScreen] = useState('splash');
            const [toastMessage, setToastMessage] = useState('');
            const [toastType, setToastType] = useState('info');

            const [isConfirmModalOpen, setIsConfirmModalOpen] = useState(false);
            const [confirmAction, setConfirmAction] = useState(null); 

            useEffect(() => {
                const checkPersistentLogin = async () => {
                    // Mockup: Simula login persistente
                    setTimeout(() => {
                        const storedEmail = localStorage.getItem('loggedInAdminEmail');
                        if (storedEmail) {
                            setLoggedInUser({ name: storedEmail.split('@')[0], email: storedEmail });
                            showToast('Login automático. Bem-vindo(a) de volta! (Mockup)', 'success');
                            setActiveScreen('dashboard');
                        } else {
                            setActiveScreen('adminAuth');
                        }
                    }, 1000); // Simula um atraso de carregamento
                };

                if (activeScreen === 'splash') {
                    checkPersistentLogin();
                }
            }, [activeScreen]); 

            const showToast = (message, type = 'info') => {
                setToastMessage(message);
                setToastType(type);
                setTimeout(() => setToastMessage(''), 4000);
            };

            const handleAuthSuccess = async (name, email, recordId) => {
                setLoggedInUser({ name, email });
                localStorage.setItem('loggedInAdminEmail', email); // Mockup: Salva no localStorage
                localStorage.setItem('adminRecordId', recordId); // Mockup: Salva no localStorage
                setActiveScreen('dashboard');
            };

            const handleLogout = () => {
                setConfirmAction(() => () => {
                    localStorage.removeItem('loggedInAdminEmail'); // Mockup: Remove do localStorage
                    localStorage.removeItem('adminRecordId'); // Mockup: Remove do localStorage
                    setLoggedInUser(null);
                    setToastMessage('Sessão encerrada. (Mockup)', 'info');
                    setActiveScreen('adminAuth');
                });
                setIsConfirmModalOpen(true);
            };

            const renderScreen = () => {
                switch (activeScreen) {
                    case 'dashboard': return <Dashboard showToast={showToast} />;
                    case 'contentManagement': return <ContentManagement showToast={showToast} />;
                    case 'userManagement': return <UserManagement showToast={showToast} />;
                    case 'userDoubts': return <UserDoubts showToast={showToast} />;
                    case 'reports': return <Reports showToast={showToast} />;
                    case 'bioWalletValidations': return <BioWalletValidations showToast={showToast} />; {/* NOVA TELA */}
                    default: return <Dashboard />;
                }
            };

            const renderContent = () => {
                if (activeScreen === 'splash') {
                    return <SplashPage />;
                }
                if (activeScreen === 'adminAuth' || !loggedInUser) {
                    return <AdminLoginPage onAuthSuccess={handleAuthSuccess} showToast={showToast} />;
                }
                return (
                    <div className="flex min-h-screen bg-gray-100 font-poppins"> {/* Usando Poppins */}
                        <aside className="w-64 bg-gray-800 text-white p-4 flex flex-col flex-shrink-0">
                            <div className="flex-grow">
                                <h1 className="text-2xl font-bold mb-8 text-center border-b border-gray-700 pb-4">Admin Biogás</h1>
                                <nav>
                                    <ul>
                                        <NavItem icon={<HomeIcon className="w-5 h-5" />} text="Dashboard" isActive={activeScreen === 'dashboard'} onClick={() => setActiveScreen('dashboard')} />
                                        <NavItem icon={<BookTextIcon className="w-5 h-5" />} text="Gestão de Conteúdo" isActive={activeScreen === 'contentManagement'} onClick={() => setActiveScreen('contentManagement')} />
                                        <NavItem icon={<UsersIcon className="w-5 h-5" />} text="Gestão de Usuários" isActive={activeScreen === 'userManagement'} onClick={() => setActiveScreen('userManagement')} />
                                        <NavItem icon={<MessageSquareIcon className="w-5 h-5" />} text="Dúvidas dos Usuários" isActive={activeScreen === 'userDoubts'} onClick={() => setActiveScreen('userDoubts')} />
                                        <NavItem icon={<BarChartIcon className="w-5 h-5" />} text="Relatórios" isActive={activeScreen === 'reports'} onClick={() => setActiveScreen('reports')} />
                                        <NavItem icon={<WalletIcon className="w-5 h-5" />} text="Validações BioCarteira" isActive={activeScreen === 'bioWalletValidations'} onClick={() => setActiveScreen('bioWalletValidations')} /> {/* NOVO ITEM */}
                                    </ul>
                                </nav>
                            </div>
                            <div className="mt-auto">
                                <button
                                    onClick={handleLogout}
                                    className="flex items-center w-full p-3 rounded-lg bg-red-600 hover:bg-red-700 font-semibold shadow-md transition-all duration-200"
                                >
                                    <LogOutIcon className="w-5 h-5" />
                                    <span className="ml-3">Sair ({loggedInUser.name})</span>
                                </button>
                            </div>
                        </aside>
                        <main className="flex-1 p-6 md:p-8 overflow-y-auto">
                            {renderScreen()}
                        </main>
                    </div>
                );
            };

            return (
                <React.Fragment>
                    {renderContent()}
                    <Toast message={toastMessage} type={toastType} onClose={() => setToastMessage('')} />
                    <ConfirmModal
                        isOpen={isConfirmModalOpen}
                        onClose={() => setIsConfirmModalOpen(false)}
                        onConfirm={confirmAction}
                        message="Tem certeza que deseja sair?"
                    />
                </React.Fragment>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
